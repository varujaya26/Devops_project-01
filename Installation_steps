Docker deployment

Step 1: creating a war file
Installation: JDK, maven, git 

$mkdir maven-war
$git init
$mvn —version

$mvn archetype:generate -DgroupId=com.mycompany.app -DartifactId=war -DarchetypeArtifactId=maven-archetype-webapp -DarchetypeVersion=1.4 -DinteractiveMode=false

$cd war
$mvn clean install

Step 2: To push to repo
$ cd maven-war
$ git clone https://github.com/varujaya26/docker-deployment.git
$ git branch war
$ git checkout war
Copy and paste the war folder src and pom.xml to docker-deployment dir
$ cp -R src ../docker-deployment/src
$cp -R pom.xml ../docker-deployment/pom.xml
$git status
$git add .
$git commit -m “war”

Step 3: Jenkins Installation

Installing Jdk, scm, build tool, Jenkins on AWS LINUX 2 as Jenkins Master

JDK installed along with Maven
$ sudo yum install maven git -y

$mvn —version

$ sudo wget -O /etc/yum.repos.d/jenkins.repo \
    https://pkg.jenkins.io/redhat-stable/jenkins.repo

$ sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

$ sudo yum install jenkins -y

$sudo systemctl enable jenkins

$ sudo systemctl start jenkins

$ sudo systemctl status jenkins

Go to http://$ip_address:8080/ 

The Jenkins passwd is stored in /var/lib/jenkins/secrets/initialAdminPassword

$ sudo cat /var/lib/jenkins/secrets/initialAdminPassword on the Jenkins Master

Enter the password and start the plugins installation

Step 4: Docker installation

$sudo yum update -y

$sudo yum install docker

$ sudo service docker start 

$ sudo systemctl enable docker.service

$ sudo systemctl status docker.service

$sudo usermod -aG docker ec2-user

$sudo su -

$sudo su - ec2-user

$docker info

Step 5: Add docker hub credentials to Jenkins

To build docker image and push it to the repository using pipeline script

Step 6: Create users dev1, dev2, test, prod
In Jenkins
Install role-based authorization plugin to manage access to the users.

Step 7: Preparing the deployment server
As ec2-user
    1  sudo adduser test
    2  sudo passwd test
    3  sudo groupadd docker
    4  sudo usermod -aG docker test
    5  sudo visudo
        >> test ALL=(ALL) NOPASSWD:/usr/bin/docker	run *
         >> test ALL=(ALL) NOPASSWD:/usr/bin/docker	pull *
    6  sudo su -
As root
    1   /usr/bin/yum install docker -y
    2  /usr/bin/systemctl start docker
    3  /usr/bin/systemctl enable docker
    4  vi /etc/ssh/sshd_config
    5  service sshd restart
Step 8: Use the Jenkinsfile for final deployment

